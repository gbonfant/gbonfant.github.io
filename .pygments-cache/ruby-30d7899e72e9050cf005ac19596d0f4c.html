<div class="highlight"><pre><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">BaseModel</span>
  <span class="kp">attr_accessor</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:birth_date</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">attributes</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">)</span>
    <span class="k">super</span>

    <span class="n">assign_dates</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span> <span class="k">if</span> <span class="n">attributes</span>
  <span class="k">end</span>

  <span class="kp">protected</span>

  <span class="k">def</span> <span class="nf">assign_dates</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
    <span class="n">new_attributes</span>            <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">stringify_keys</span>
    <span class="n">multiparameter_attributes</span> <span class="o">=</span> <span class="n">extract_multiparameter_attributes</span><span class="p">(</span><span class="n">new_attributes</span><span class="p">)</span>

    <span class="n">multiparameter_attributes</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">multiparameter_attribute</span><span class="p">,</span> <span class="n">values_hash</span><span class="o">|</span>
      <span class="n">set_values</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">{</span> <span class="o">|</span><span class="n">position</span><span class="o">|</span> <span class="n">values_hash</span><span class="o">[</span><span class="n">position</span><span class="o">].</span><span class="n">to_i</span> <span class="p">}</span>

      <span class="nb">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">multiparameter_attribute</span><span class="si">}</span><span class="s2">=&quot;</span><span class="p">,</span> <span class="no">Date</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="o">*</span><span class="n">set_values</span><span class="p">))</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">extract_multiparameter_attributes</span><span class="p">(</span><span class="n">new_attributes</span><span class="p">)</span>
    <span class="n">multiparameter_attributes</span> <span class="o">=</span> <span class="o">[]</span>

    <span class="n">new_attributes</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">|</span>
      <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
        <span class="n">multiparameter_attributes</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">]</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">extract_attributes</span><span class="p">(</span><span class="n">multiparameter_attributes</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">extract_attributes</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">pairs</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">pair</span><span class="o">|</span>
      <span class="n">multiparameter_name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">pair</span>
      <span class="n">attribute_name</span>             <span class="o">=</span> <span class="n">multiparameter_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
      <span class="n">attributes</span><span class="o">[</span><span class="n">attribute_name</span><span class="o">]</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">unless</span> <span class="n">attributes</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">)</span>

      <span class="n">attributes</span><span class="o">[</span><span class="n">attribute_name</span><span class="o">][</span><span class="n">find_parameter_position</span><span class="p">(</span><span class="n">multiparameter_name</span><span class="p">)</span><span class="o">]</span> <span class="o">||=</span> <span class="n">value</span>
    <span class="k">end</span>

    <span class="n">attributes</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">find_parameter_position</span><span class="p">(</span><span class="n">multiparameter_name</span><span class="p">)</span>
    <span class="n">multiparameter_name</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="sr">/\(([0-9]*).*\)/</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">to_i</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>